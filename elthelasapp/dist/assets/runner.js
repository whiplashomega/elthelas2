import{N as J,J as q,k as K,s as z,B as Q,l as W,m as T,g as Y,_ as Z,h as g,o as b,c as f,a as s,e as h,n as k,C as M,A as ee,t as c,F as D,r as A,i as v,w as m,H as C,d as I,v as te,p as se,f as oe,b as N}from"./index.js";import{c as ae}from"./creature.js";const ne={name:"",tags:"",size:"",cr:"",type:"",subtype:"",alignment:"",ac:"",acdesc:"",hp:"",hpdesc:"",speed:"",str:"",dex:"",con:"",int:"",wis:"",cha:"",skills:"",saves:"",senses:"",damageimmunities:"",conditionimmunities:"",damageresistances:"",languages:"",locations:"",latlong:"",description:""},le=[{cr:0,xp:10},{cr:.125,xp:25},{cr:.25,xp:50},{cr:.5,xp:100},{cr:1,xp:200},{cr:2,xp:450},{cr:3,xp:700},{cr:4,xp:1100},{cr:5,xp:1800},{cr:6,xp:2300},{cr:7,xp:2900},{cr:8,xp:3900},{cr:9,xp:5e3},{cr:10,xp:5900},{cr:11,xp:7200},{cr:12,xp:8400},{cr:13,xp:1e4},{cr:14,xp:11500},{cr:15,xp:13e3},{cr:16,xp:15e3},{cr:17,xp:18e3},{cr:18,xp:2e4},{cr:19,xp:22e3},{cr:20,xp:25e3},{cr:21,xp:33e3},{cr:22,xp:41e3},{cr:23,xp:5e4},{cr:24,xp:62e3},{cr:26,xp:9e4},{cr:30,xp:155e3}],re={setup(){const e=J(),t=q(),a=K(),{creatures:l}=z(e),{charlevel:p,accalc:i,getSpeedStat:n,getStatTotal:r,getStatMod:u,getSaveMod:y,getSkillMod:B,getHPTotal:w,getAttackBonus:V,getDamageBonus:$,totalslots:o,getInitMod:_,getCharacter:S,characters:E}=z(t),{loggedin:P,isLoggedIn:L,isAdmin:U,getUserInfo:F}=a,{getFromServer:x,loadChar:R,selCharacter:j}=t,{getCreature:H,saveNewCreature:O,deleteCreature:X,getAllCreatures:G}=e;return G(),Q({title:"Encounter Runner"}),{creatures:l,charlevel:p,accalc:i,getSpeedStat:n,getStatTotal:r,getStatMod:u,getSaveMod:y,getSkillMod:B,getHPTotal:w,getAttackBonus:V,getDamageBonus:$,totalslots:o,getInitMod:_,curcharacter:S,characters:E,token:P,loggedin:L,admin:U,userinfo:F,getFromServer:x,loadChar:R,selCharacter:j,getCreature:H,saveNewCreature:O,deleteCreature:X}},props:{creArray:Array,charArray:Array},components:{modal:W,creature:ae},computed:{filteredcreatures(){let e=this;return this.creatures.filter(t=>{var a=e.creaturestable.filterValue.split(" ");let l=!0;return e.typeFilter!==""&&t.type!==e.typeFilter&&(l=!1),a.forEach(p=>{let i=e.creaturestable.filterBy.some(function(n){for(var r in t)if(n===r&&t[r].toString().toLowerCase().includes(p.toLowerCase()))return!0});e.creaturestable.filterValue&&!i&&(l=!1)}),!!l}).sort((t,a)=>t[this.creaturestable.sortBy]>a[this.creaturestable.sortBy]&&this.creaturestable.sortDesc===!1||t[this.creaturestable.sortBy]<a[this.creaturestable.sortBy]&&this.creaturestable.sortDesc===!0?1:-1)},statBlocks(){let e=[];return this.encountercreatures.forEach(t=>{t.ispc||e.findIndex(l=>l.name===t.name)===-1&&e.push(t)}),e},encountercreaturesinit(){return this.encountercreatures.sort((e,t)=>e.init>t.init?-1:1)},encounterlink(){return"/runner/"+this.encountercreatures.map(e=>e.name.replace(/ /g,"").toLowerCase()).join("&")}},data(){return{creaturestable:{fields:[{key:"name",label:"Name",sortable:!0},{key:"size",label:"Size",sortable:!0},{key:"cr",label:"CR",sortable:!0},{key:"type",label:"Type",sortable:!0},{key:"subtype",label:"Subtype",sortable:!0},{key:"alignment",label:"Alignment",sortable:!0}],filterValue:"",sortBy:"name",sortDesc:!1,filterBy:["name","size","cr","subtype","alignment"],modalInfo:{...ne}},modalProps:{isActive:!1},typeFilter:"",nextIndex:0,partylevel:1,partysize:4,difficulty:"",xpvalue:0,terrain:1,adjustedxpvalue:0,aoe:!1,comp:this,encountercreatures:[]}},methods:{del(e){confirm("are you sure you want to delete "+e.name+"? It cannot be recovered if you do.")+this.admin&&this.deleteCreature(e._id)},edit(e){confirm("are you sure you want to edit "+e.name+"?")+this.admin&&this.$router.push("/tools/creaturebuilder/"+e._id)},xpByCR(e){return le.find(t=>t.cr===e).xp},calculateDifficulty(){for(var e=[25,50,75,125,250,300,350,450,550,600,800,1e3,1100,1250,1400,1600,2e3,2100,2400,2800],t=[50,100,150,250,500,600,750,900,1100,1200,1600,2e3,2200,2500,2800,3200,3900,4200,4900,5700],a=[75,150,225,375,750,900,1100,1400,1600,1900,2400,3e3,3400,3800,4300,4800,5900,6300,7300,8500],l=[100,200,400,500,1100,1400,1700,2100,2400,2800,3600,4500,5100,5700,6400,7200,8800,9500,10900,12700],p=e[this.partylevel-1]*this.partysize,i=t[this.partylevel-1]*this.partysize,n=a[this.partylevel-1]*this.partysize,r=l[this.partylevel-1]*this.partysize,u=0,y=0;y<this.encountercreatures.length;y++)this.encountercreatures[y].ispc||(u+=this.xpByCR(this.encountercreatures[y].cr));this.xpvalue=u,u*=4/(this.partysize+1),u*=1+this.encountercreatures.length*.1,u*=this.terrain*(1+.05*this.aoe*this.partysize),this.adjustedxpvalue=Math.floor(u),u<p?this.difficulty="too easy":u<i?this.difficulty="easy":u<n?this.difficulty="medium":u<r?this.difficulty="hard":u<r*1.5?this.difficulty="deadly":this.difficulty="nigh on impossible"},async addToEncounter(e){e.description||(e=await this.getCreature(e._id));var t=Object.assign({},e);t.id=this.nextIndex,t.ispc=!1,this.nextIndex++,t.currenthp=t.hp,t.descr=T.parse(t.description),t.mini="",t.initMod=t.dexmod,t.advantage=!1,t.disadvantage=!1,t.init=0,this.encountercreatures.push(t),this.calculateDifficulty()},removeCreature(e){this.encountercreatures=this.encountercreatures.filter(t=>t.id!==e.id),this.calculateDifficulty()},createSkillsArray(e){return e.skills.reduce((t,a)=>(a.prof>0&&t.push("+"+this.getSkillMod(a)+" "+a.name),t),[])},createDescription(e){let t=this,a=e.attacks.reduce((i,n)=>{let r="**"+n.name+":** "+n.type+", range "+n.range+", ";return t.getAttackBonus(n)>-1&&(r+="+"),r+=t.getAttackBonus(n)+" to hit ("+n.damage,t.getDamageBonus(n)>0?r+=" +"+t.getDamageBonus(n):t.getDamageBonus(n)<0&&(r+=" -"+t.getDamageBonus(n)),r+=" "+n.dtype+" damage ",n.damage2!==""&&(r+=" + "+n.damage2+" "+n.dtype2+" damage"),i+r+`

`},""),l=(i,n)=>i+"**"+n.name+":** "+n.description+`

`;a=e.feats.reduce(l,a),a=e.charclasses.reduce((i,n)=>(i=n.thisclass.features.reduce(l,i),i=n.selsubclass.features.reduce(l,i),i),a),e.race.traits&&(a=e.race.traits.reduce(l,a)),a=e.features.reduce(l,a);let p=`**Spells**

`;for(let i in e.spells)e.spells[i].length>0&&(p+="**"+i+"("+this.totalslots(i)+" slots):** "+e.spells[i].reduce((n,r)=>n+r.title+(r.prepared?"*":"")+", ","")+`

`);return p.length>14&&(a+=p),T.parse(a)},buildCreature(e,t){this.setCharacter(e);let a={id:this.nextIndex,name:e.name,size:"medium",type:"humanoid",ispc:t,subtype:e.race.singular,alignment:e.alignment,acdesc:this.accalc,speed:this.getSpeedStat(0)+" ft",str:this.getStatTotal(0)+0,dex:this.getStatTotal(1),con:this.getStatTotal(2),int:this.getStatTotal(3),wis:this.getStatTotal(4),cha:this.getStatTotal(5),strmod:this.getStatMod(0),dexmod:this.getStatMod(1),conmod:this.getStatMod(2),intmod:this.getStatMod(3),wismod:this.getStatMod(4),chamod:this.getStatMod(5),saves:"+"+this.getSaveMod(0)+" strength +"+this.getSaveMod(1)+" dexterity +"+this.getSaveMod(2)+" constitution +"+this.getSaveMod(3)+" intelligence +"+this.getSaveMod(4)+" wisdom +"+this.getSaveMod(5)+" charisma.",skills:this.createSkillsArray(e),senses:"",damageresistances:"",damageimmunities:"",conditionimmunities:"",languages:e.proficiencies,cr:this.charlevel(e)-1,descr:this.createDescription(e),mini:"",currenthp:e.hpcurrent,hpdesc:this.getHPTotal,initMod:this.getInitMod,advantage:!1,disadvantage:!1,init:0};this.encountercreatures.push(a),this.nextIndex++,this.calculateDifficulty()},async selCharacter(e){await this.loadChar({character:e,comp:this,passthrough:!0}).then(()=>{this.buildCreature(e,!1),this.$root.$emit("bv::hide::modal","servermodal")})},roll(){let e=[];this.encountercreatures.forEach(t=>{let a=e.findIndex(l=>l.name===t.name);if(a!==-1)t.init=e[a].init;else{let l=Number(t.initMod)+Math.floor(Math.random()*20)+1,p=Number(t.initMod)+Math.floor(Math.random()*20)+1;t.advantage&&!t.disadvantage?l>p?t.init=l:t.init=p:!t.advantage&&t.disadvantage?l<p?t.init=l:t.init=p:t.init=l,e.push(t)}})},getCreaturesOnMount(e){this.$store.dispatch("getAllCreatures").then(()=>{for(var t=0;t<e.length;t++){var a=this.creatures.filter(function(l){return l.name.toLowerCase().replace(/ /g,"")===e[t].toLowerCase().replace(/ /g,"")});a.length>0&&this.addToEncounter(a[0])}this.calculateDifficulty()})},async loadCharacters(e){e.forEach(t=>{this.buildCreature(t,!0)})}},mounted(){if(this.encountercreatures=[],this.$route.params.encounter){console.log("there is an encounter parameter");var e=this.$route.params.encounter.split("&");this.getCreaturesOnMount(e)}else typeof this.creArray<"u"&&this.creArray.length>0&&(console.log("running in campaign setting"),e=this.creArray,this.getCreaturesOnMount(e));typeof this.charArray<"u"&&this.charArray.length>0&&(this.loadCharacters(this.charArray),this.partysize=this.charArray.length,this.partylevel=Y.charlevel(this.charArray[0]))}};const d=e=>(se("data-v-b91b2a10"),e=e(),oe(),e),ie={class:"col-sm-12"},ue={class:"col-sm-9"},de=["href"],ce={class:"row"},pe={class:"col-sm-8"},he=N('<option value="1" data-v-b91b2a10>1</option><option value="2" data-v-b91b2a10>2</option><option value="3" data-v-b91b2a10>3</option><option value="4" data-v-b91b2a10>4</option><option value="5" data-v-b91b2a10>5</option><option value="6" data-v-b91b2a10>6</option><option value="7" data-v-b91b2a10>7</option><option value="8" data-v-b91b2a10>8</option><option value="9" data-v-b91b2a10>9</option><option value="10" data-v-b91b2a10>10</option>',10),ve=[he],me=N('<option value="1" data-v-b91b2a10>1</option><option value="2" data-v-b91b2a10>2</option><option value="3" data-v-b91b2a10>3</option><option value="4" data-v-b91b2a10>4</option><option value="5" data-v-b91b2a10>5</option><option value="6" data-v-b91b2a10>6</option><option value="7" data-v-b91b2a10>7</option><option value="8" data-v-b91b2a10>8</option><option value="9" data-v-b91b2a10>9</option><option value="10" data-v-b91b2a10>10</option><option value="11" data-v-b91b2a10>11</option><option value="12" data-v-b91b2a10>12</option><option value="13" data-v-b91b2a10>13</option><option value="14" data-v-b91b2a10>14</option><option value="15" data-v-b91b2a10>15</option><option value="16" data-v-b91b2a10>16</option><option value="17" data-v-b91b2a10>17</option><option value="18" data-v-b91b2a10>18</option><option value="19" data-v-b91b2a10>19</option><option value="20" data-v-b91b2a10>20</option>',20),be=[me],fe=["value"],ye=d(()=>s("option",{value:1},"None",-1)),ge=["value"],_e={class:"col-sm-4"},Ce=d(()=>s("br",null,null,-1)),ke=d(()=>s("br",null,null,-1)),Se={class:"row"},Me=d(()=>s("i",{class:"handle"},"\u2190\u2192",-1)),De={class:"creature"},Ae=d(()=>s("option",{value:""},"All",-1)),Be=d(()=>s("option",{value:"aberration"},"Aberration",-1)),we=d(()=>s("option",{value:"beast"},"Beast",-1)),Ve=d(()=>s("option",{value:"celestial"},"Celestial",-1)),$e=d(()=>s("option",{value:"construct"},"Construct",-1)),ze=d(()=>s("option",{value:"dragon"},"Dragon",-1)),Te=d(()=>s("option",{value:"elemental"},"Elemental",-1)),Ie=d(()=>s("option",{value:"fiend"},"Fiend",-1)),Ne=d(()=>s("option",{value:"giant"},"Giant",-1)),Ee=d(()=>s("option",{value:"humanoid"},"Humanoid",-1)),Pe=d(()=>s("option",{value:"monstrosity"},"Monstrosity",-1)),Le=d(()=>s("option",{value:"plant"},"Plant",-1)),Ue=d(()=>s("option",{value:"ooze"},"Ooze",-1)),Fe=d(()=>s("option",{value:"undead"},"Undead",-1)),xe=[Ae,Be,we,Ve,$e,ze,Te,Ie,Ne,Ee,Pe,Le,Ue,Fe],Re=["disabled"],je={class:"table table-striped table-responsive",id:"creaturetable"},He=["onClick"],Oe=["onClick"],Xe=["onClick"],Ge={id:"inithptracker"},Je={class:"row"},qe={class:"col-sm-5"},Ke={class:"col-sm-2"},Qe={class:"col-sm-5"},We={class:"row"},Ye={class:"col-sm-3"},Ze=["onUpdate:modelValue"],et={class:"col-sm-3"},tt={class:"col-sm-3"},st=["onClick"],ot={class:"table table-striped"},at=d(()=>s("tr",null,[s("th",null,"Character Name"),s("th",null,"Level"),s("th",null,"-")],-1)),nt=["onClick"];function lt(e,t,a,l,p,i){const n=g("creature"),r=g("b-col"),u=g("b-form-checkbox"),y=g("b-form-checkbox-group"),B=g("b-form-input"),w=g("b-input-group"),V=g("b-row"),$=g("modal");return b(),f("div",ie,[s("div",ue,[s("p",null,[s("a",{href:e.encounterlink},"Link to this Encounter",8,de)]),s("div",ce,[s("div",pe,[s("label",null,[h(" Party Size "),k(s("select",{class:"form-control","onUpdate:modelValue":t[0]||(t[0]=o=>e.partysize=o),onChange:t[1]||(t[1]=o=>e.calculateDifficulty())},ve,544),[[M,e.partysize]])]),s("label",null,[h(" Average Level "),k(s("select",{class:"form-control","onUpdate:modelValue":t[2]||(t[2]=o=>e.partylevel=o),onChange:t[3]||(t[3]=o=>e.calculateDifficulty())},be,544),[[M,e.partylevel]])]),s("label",null,[h(" Terrain "),k(s("select",{class:"form-control","onUpdate:modelValue":t[4]||(t[4]=o=>e.terrain=o),onChange:t[5]||(t[5]=o=>e.calculateDifficulty())},[s("option",{value:.75},"Player Advantage",8,fe),ye,s("option",{value:1.25},"Monster Advantage",8,ge)],544),[[M,e.terrain]])]),s("label",null,[h(" Monster Has Powerful AoE "),k(s("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":t[6]||(t[6]=o=>e.aoe=o),onChange:t[7]||(t[7]=o=>e.calculateDifficulty())},null,544),[[ee,e.aoe]])])]),s("div",_e,[s("input",{type:"button",class:"btn btn-primary",value:"Calculate",onClick:t[8]||(t[8]=o=>e.calculateDifficulty())}),h(" Encounter Difficulty: "+c(e.difficulty)+" ",1),Ce,h(" XP Value: "+c(e.xpvalue),1),ke,h(" Adjusted XP Value: "+c(e.adjustedxpvalue),1)])]),s("div",null,[s("input",{type:"button",onClick:t[9]||(t[9]=o=>{e.getFromServer(),e.modalProps.isActive=!0}),value:"Load Character",class:"btn btn-success margin15"})]),s("div",Se,[(b(!0),f(D,null,A(e.statBlocks,o=>(b(),f("div",{key:o.id,class:"col-sm-4"},[s("h2",null,[h(c(o.name)+" ",1),Me]),s("div",De,[v(n,{creature:o},null,8,["creature"])])]))),128))]),v(V,null,{default:m(()=>[v(r,{md:"2"},{default:m(()=>[s("label",null,[h(" Type "),k(s("select",{"onUpdate:modelValue":t[10]||(t[10]=o=>e.typeFilter=o),class:"form-control"},xe,512),[[M,e.typeFilter]])])]),_:1}),v(r,{md:"6"},{default:m(()=>[v(y,{modelValue:e.creaturestable.filterBy,"onUpdate:modelValue":t[11]||(t[11]=o=>e.creaturestable.filterBy=o)},{default:m(()=>[v(u,{value:"name"},{default:m(()=>[h("Name")]),_:1}),v(u,{value:"size"},{default:m(()=>[h("Size")]),_:1}),v(u,{value:"cr"},{default:m(()=>[h("CR")]),_:1}),v(u,{value:"subtype"},{default:m(()=>[h("Subtype")]),_:1}),v(u,{value:"alignment"},{default:m(()=>[h("Alignment")]),_:1})]),_:1},8,["modelValue"])]),_:1}),v(r,{md:"4",class:"my-1"},{default:m(()=>[v(w,null,{default:m(()=>[v(B,{modelValue:e.creaturestable.filterValue,"onUpdate:modelValue":t[12]||(t[12]=o=>e.creaturestable.filterValue=o),placeholder:"Type to Search"},null,8,["modelValue"]),s("button",{class:"btn btn-primary",disabled:!e.creaturestable.filterValue,onClick:t[13]||(t[13]=o=>e.creaturestable.filterValue="")},"Clear",8,Re)]),_:1})]),_:1})]),_:1}),s("table",je,[s("thead",null,[s("tr",null,[s("th",null,[s("a",{href:"#",onClick:t[14]||(t[14]=C(o=>{e.creaturestable.sortBy="name",e.creaturestable.sortDesc=!e.creaturestable.sortDesc},["stop"]))},"Name")]),s("th",null,[s("a",{href:"#",onClick:t[15]||(t[15]=C(o=>{e.creaturestable.sortBy="size",e.creaturestable.sortDesc=!e.creaturestable.sortDesc},["stop"]))},"Size")]),s("th",null,[s("a",{href:"#",onClick:t[16]||(t[16]=C(o=>{e.creaturestable.sortBy="cr",e.creaturestable.sortDesc=!e.creaturestable.sortDesc},["stop"]))},"CR")]),s("th",null,[s("a",{href:"#",onClick:t[17]||(t[17]=C(o=>{e.creaturestable.sortBy="type",e.creaturestable.sortDesc=!e.creaturestable.sortDesc},["stop"]))},"Type")]),s("th",null,[s("a",{href:"#",onClick:t[18]||(t[18]=C(o=>{e.creaturestable.sortBy="subtype",e.creaturestable.sortDesc=!e.creaturestable.sortDesc},["stop"]))},"Subtype")]),s("th",null,[s("a",{href:"#",onClick:t[19]||(t[19]=C(o=>{e.creaturestable.sortBy="alignment",e.creaturestable.sortDesc=!e.creaturestable.sortDesc},["stop"]))},"Alignment")])])]),s("tbody",null,[(b(!0),f(D,null,A(e.filteredcreatures,(o,_)=>(b(),f("tr",{key:o._id},[s("td",null,[s("span",null,[s("a",{href:"#",onClick:C(S=>e.addToEncounter(o,_,S.target),["stop"])},c(o.name),9,He),e.admin?(b(),f("button",{key:0,class:"btn btn-warning btn-sm",onClick:S=>e.edit(o)},"\u270E",8,Oe)):I("",!0),e.admin?(b(),f("button",{key:1,class:"btn btn-sm btn-danger",onClick:S=>e.del(o)},"X",8,Xe)):I("",!0)])]),s("td",null,c(o.size),1),s("td",null,c(o.cr),1),s("td",null,c(o.type),1),s("td",null,c(o.subtype),1),s("td",null,c(o.alignment),1)]))),128))])])]),s("div",Ge,[(b(!0),f(D,null,A(e.encountercreaturesinit,o=>(b(),f("div",{key:o.id,class:"form-inline form-row"},[s("div",Je,[s("div",qe,c(o.name)+"\xA0",1),s("div",Ke,"AC "+c(o.ac),1),s("div",Qe,c(o.speed),1)]),s("div",We,[s("div",Ye,[k(s("input",{type:"number","onUpdate:modelValue":_=>o.currenthp=_,style:{"font-size":"0.7rem"},class:"form-control form-control-sm"},null,8,Ze),[[te,o.currenthp]])]),s("div",et," / "+c(o.hpdesc),1),s("div",tt,[s("button",{class:"close",type:"button",onClick:_=>e.removeCreature(o)},"\xD7",8,st)])])]))),128))]),v($,{id:"servermodal",title:"Load File from Server",modalProps:e.modalProps},{default:m(()=>[s("table",ot,[at,(b(!0),f(D,null,A(e.characters,o=>(b(),f("tr",{key:o._id},[s("td",null,[s("a",{class:"clickable",onClick:_=>e.selCharacter(o)},c(o.name),9,nt)]),s("td",null,c(e.charlevel(o)),1)]))),128))])]),_:1},8,["modalProps"])])}const ut=Z(re,[["render",lt],["__scopeId","data-v-b91b2a10"]]);export{ut as default};
