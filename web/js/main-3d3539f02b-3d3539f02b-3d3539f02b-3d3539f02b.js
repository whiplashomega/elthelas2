"use strict";!function(e,t){var r=t.module("elthelas",["ui.router","hc.marked","ui.bootstrap","ngCookies"]);r.run(["$state","$stateParams",function(e,t){}]),r.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,r){e.state("app",{url:"/",views:{header:{templateUrl:"/html/header/header.html",controller:"HeaderController"},footer:{templateUrl:"/html/footer/footer.html"},content:{templateUrl:"/html/content/home.html"},head:{templateUrl:"/html/head/home.html"},sidebar:{templateUrl:"/html/empty.html"}},data:{title:"Home"}}).state("app.domains",{url:"options/domains",views:{"content@":{templateUrl:"/html/content/options/domains.html"},"head@":{templateUrl:"/html/head/options/domains.html"},"sidebar@":{templateUrl:"/html/sidebar/options.html"}},data:{title:"Domains"}}).state("app.races",{url:"options/races",views:{"content@":{templateUrl:"/html/content/options/races.html",controller:"RaceController"},"head@":{templateUrl:"/html/head/options/races.html"},"sidebar@":{templateUrl:"/html/sidebar/options.html"}},data:{title:"Races"}}).state("app.languages",{url:"options/languages",views:{"content@":{templateUrl:"/html/content/options/languages.html",controller:"LanguagesController"},"head@":{templateUrl:"/html/head/options/languages.html"},"sidebar@":{templateUrl:"/html/sidebar/options.html"}},data:{title:"Languages"}}).state("app.gods",{url:"ref/gods",views:{"content@":{templateUrl:"/html/content/ref/gods.html",controller:"GodsController"},"head@":{templateUrl:"/html/head/ref/gods.html"},"sidebar@":{templateUrl:"/html/sidebar/ref.html"}},data:{title:"Gods"}}).state("app.organizations",{url:"ref/orgs",views:{"content@":{templateUrl:"/html/content/ref/organizations.html",controller:"OrganizationController"},"head@":{templateUrl:"/html/head/ref/organizations.html"},"sidebar@":{templateUrl:"/html/sidebar/ref.html"}},data:{title:"Organizations"}}).state("app.calendar",{url:"ref/calendar",views:{"content@":{templateUrl:"/html/content/ref/calendar.html"},"head@":{templateUrl:"/html/head/ref/calendar.html"},"sidebar@":{templateUrl:"/html/sidebar/ref.html"}},data:{title:"Calendar"}}).state("app.cosmology",{url:"ref/cosmology",views:{"content@":{templateUrl:"/html/content/ref/cosmology.html"},"head@":{templateUrl:"/html/head/ref/cosmology.html"},"sidebar@":{templateUrl:"/html/sidebar/ref.html"}},data:{title:"Cosmology"}}).state("app.astronomy",{url:"ref/astronomy",views:{"content@":{templateUrl:"/html/content/ref/astronomy.html"},"head@":{templateUrl:"/html/head/ref/astronomy.html"},"sidebar@":{templateUrl:"/html/sidebar/ref.html"}},data:{title:"Astronomy"}}).state("app.magic",{url:"ref/magic",views:{"content@":{templateUrl:"/html/content/ref/magic.html"},"head@":{templateUrl:"/html/head/ref/magic.html"},"sidebar@":{templateUrl:"/html/sidebar/ref.html"}},data:{title:"Magic"}}).state("app.divines",{url:"ref/divines",views:{"content@":{templateUrl:"/html/content/ref/divines.html",controller:"DivineController"},"head@":{templateUrl:"/html/head/ref/divines.html"},"sidebar@":{templateUrl:"/html/sidebar/ref.html"}},data:{title:"Divines"}}).state("app.quickref",{url:"ref/quick",views:{"content@":{templateUrl:"/html/content/ref/quick.html",controller:"QuickController"},"head@":{templateUrl:"/html/head/ref/quick.html"},"sidebar@":{templateUrl:"/html/sidebar/ref.html"}},data:{title:"Quick Reference Manual"}}).state("app.history",{url:"history",views:{"content@":{templateUrl:"/html/content/history.html",controller:"HistoryController"},"head@":{templateUrl:"/html/head/history.html"},"sidebar@":{templateUrl:"/html/empty.html"}},data:{title:"History"}}),r.html5Mode(!0)}])}(jQuery,angular),function(e,t){t.module("elthelas").controller("DivineController",["$scope","divineProvider",function(e,t){e.Divine="",e.divines=[],e.types=[],e.divineFilter=null,e.filterDivines=function(t){return null===e.divineFilter||t.type===e.divineFilter},e.loadDivine=function(t){e.Divine=e.divines.filter(function(e){return e.id===t})[0]},t.getDivines().then(function(t){e.divines=t.data;for(var r=0;r<e.divines.length;r++)-1===e.types.indexOf(e.divines[r].type)&&e.types.push(e.divines[r].type)})}])}(jQuery,angular),function(e,t){t.module("elthelas").controller("GodsController",["$scope","godProvider","$location",function(e,t,r){e.gods=!1,e.GodByName="",e.alignment="",e.loadGod=function(t){e.GodByName=e.gods.filter(function(e){return e.id===t})[0]},t.getGods().then(function(t){e.gods=t.data,e.loadGod(r.search().god)})}])}(jQuery,angular),function(e,t,r){e.module("elthelas").controller("HeaderController",["$scope","$state","$rootScope","$uibModal","$document","AuthenticationProvider",function(e,o,a,l,n,i){var s=r.createElement("script");s.type="text/javascript",s.async=!0,s.src=(r.location.protocol,"https://www.google.com/cse/cse.js?cx=002019895859863268942:tbtmwpd5jy8");var c=r.getElementsByTagName("script")[0];c.parentNode.insertBefore(s,c),e.title=o.current.data.title,a.$on("$stateChangeSuccess",function(t,r,a,l,n,i){e.title=o.current.data.title}),i.LoadFromCookies(),e.globals=a.globals,e.message=!1,e.login=function(r){var o=t("body");l.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"/app_dev.php/login",controller:"LoginController",size:r,appendTo:o}).result.then(function(t){e.globals=a.globals},function(){console.log("Modal dismissed at: "+new Date),e.globals=a.globals})},e.logout=function(){e.globals=void 0,i.ClearCredentials()},e.register=function(r){var o=t("body");l.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"/app_dev.php/register/",controller:"RegisterController",size:r,appendTo:o}).result.then(function(t){t(),e.message=a.message,setTimeout(function(){e.message=!1,e.$apply()},5e3)},function(){console.log("Modal dismissed at: "+new Date),e.globals=a.globals})}}])}(angular,jQuery,document),function(e,t){t.module("elthelas").controller("LanguagesController",["$scope",function(t){t.init=function(){e(".datatable").dataTable()}}])}(jQuery,angular),function(e,t){t.module("elthelas").controller("OrganizationController",["$scope","$location","organizationProvider",function(e,t,r){e.currentOrg=!1,e.loadOrg=function(t){var r=e.organizations.filter(function(e){return e.id===t});r.length>0?e.currentOrg=r[0]:e.currentOrg={id:"error",name:""}},r.getOrganizations().then(function(r){e.organizations=r.data,e.loadOrg(t.search().organization)})}])}(jQuery,angular),function(e,t){t.module("elthelas").controller("QuickController",["$scope","SpellProvider","$uibModal",function(t,r,o){t.loadSpell=function(r){t.currentSpell=t.spells[r],t.$apply();var a=e("body");o.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"/html/modals/spell.html",controller:"SpellController",size:"lg",appendTo:a,resolve:{spell:function(){return t.currentSpell}}}).result.then(function(e){},function(){console.log("Modal dismissed at: "+new Date)})},t.currentSpell=!1,t.spells,this.init=function(){r.getSpells().then(function(r){t.spells=r.data;for(var o=[],a=0;a<t.spells.length;a++){void 0!==t.spells[a].level?t.spells[a].level=t.spells[a].level.replace("level",""):t.spells[a].level=" ";var l="spell"+a,n=[t.spells[a].title,t.spells[a].level,t.spells[a].school,t.spells[a].castingTime,t.spells[a].duration,t.spells[a].tags.join(", "),"<input type='button' value='View' class='btn btn-sm btn-primary' id='"+l+"' data-spellid='"+a+"' />"];o.push(n)}e("#spelltable").dataTable({data:o,responsive:!0,columns:[{title:"Title"},{title:"Level"},{title:"School"},{title:"Casting Time"},{title:"Duration"},{title:"Tags"},{title:"View"}],drawCallback:function(){for(var r=function(){t.loadSpell(Number(e(this).attr("data-spellid")))},o=0;o<t.spells.length;o++)e("#spell"+o).click(r)}})})},this.init()}])}(jQuery,angular),function(e,t){t.module("elthelas").controller("RaceController",["$scope","$location","raceProvider",function(t,r,o){t.currentRace=!1,t.loadRace=function(e){var r=t.races.filter(function(t){return t.id===e});r.length>0?t.currentRace=r[0]:t.currentRace={id:"error",name:""}},t.formatAgeDataRow=function(e){var t=[];try{t.push(e.name),t.push(e.agepoints.puberty),t.push(e.agepoints.sexualmaturity),t.push(e.agepoints.mentalmaturity),t.push(e.agepoints.middleage),t.push(e.agepoints.oldage),t.push(e.agepoints.averagelifespan),t.push(e.agepoints.maxage)}catch(r){t=[],void 0===e.name||null===e.name?t.push("Error"):t.push(e.name),t.push(1),t.push(2),t.push(3),t.push(4),t.push(5),t.push(6),t.push(7)}return t},t.getAllAgeData=function(){for(var e=[],r=0;r<t.races.length;r++)e.push(this.formatAgeDataRow(t.races[r]));return e},t.formatSizeDataRow=function(e,t){var r=[];null!==t&&void 0!==t||(t="default");try{var o=e.subraces.filter(function(e){return e.id===t})[0];"default"===t?r.push(e.name):r.push(o.name),r.push(Math.floor(o.averageheight/12)+"'"+o.averageheight%12+'"'),r.push(Math.floor(o.baseheight/12)+"'"+o.baseheight%12+'"'),r.push(o.heightroll),r.push(o.averageweight+" lbs"),r.push(o.baseweight+" lbs"),r.push("Height Roll * "+o.weightroll)}catch(e){r=["Error",1,1,1,1,1,1]}return r},t.getAllSizeData=function(){for(var e=[],r=0;r<t.races.length;r++){var o=t.races[r];if(null===o.subraces||void 0===o.subraces)e.push(t.formatSizeDataRow(o));else for(var a=0;a<o.subraces.length;a++)e.push(t.formatSizeDataRow(o,o.subraces[a].id))}return e},o.getRaces().then(function(o){t.races=o.data,t.loadRace(r.search().race),e("#ageTable").dataTable({data:t.getAllAgeData(),columns:[{title:"Race"},{title:"Start of Puberty"},{title:"Sexual Maturity"},{title:"Mental Maturity"},{title:"Middle Age"},{title:"Old Age"},{title:"Average Lifespan"},{title:"Maximum Age"}]}),e("#sizeTable").dataTable({data:t.getAllSizeData(),columns:[{title:"Race/Subrace"},{title:"Average Height"},{title:"Base Height"},{title:"Height Roll"},{title:"Average Weight"},{title:"Base Weight"},{title:"Weight Roll"}]})})}])}(jQuery,angular),function(e,t){angular.module("elthelas").controller("LoginController",["$scope","$location","AuthenticationProvider","$uibModalInstance",function(e,r,o,a){function l(){return n.dataLoading=!0,o.Login(e.username,e.password,n.postLogin)}var n=this;e.username,e.password,e.rememberMe,e.login=l,n.postLogin=function(r){200===r.status?r.data.success?(o.SetCredentials(e.username,e.password,e.rememberMe),a.close("login success")):(t(".modal-body .alert").remove(),t(".modal-body").prepend("<div class='alert alert-danger'>"+r.data.message+"</div>")):n.dataLoading=!1},e.cancel=function(){a.dismiss("cancel")}}])}(angular,jQuery),function(e,t){e.module("elthelas").controller("RegisterController",["$location","$http","$rootScope","$uibModalInstance","$scope","AuthenticationProvider",function(e,r,o,a,l,n){function i(){s.dataLoading=!0,n.Register(t("#fos_user_registration_form_username").val(),t("#fos_user_registration_form_plainPassword_first").val(),t("#fos_user_registration_form_plainPassword_second").val(),t("#fos_user_registration_form_email").val(),t("#fos_user_registration_form__token").val(),function(e){a.close(function(){o.message=e.data})})}var s=this;l.register=i,l.cancel=function(){a.dismiss("cancel")}}])}(angular,jQuery),function(e){e.module("elthelas").controller("SpellController",["$scope","$uibModalInstance","spell",function(e,t,r){e.spell=r,e.cancel=function(){t.close("cancel")}}])}(angular),function(e,t){e.module("elthelas").controller("HistoryController",["$scope","HistoryProvider","$uibModal",function(e,r,o){e.history=[],r.getHistory().then(function(t){e.history=t.data.sort(function(e,t){return e.date<t.date?-1:e.date>t.date?1:0})},function(){}),e.openEvent=function(e){var r=t("body");o.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"/html/modals/event.html",controller:"EventController",size:"lg",appendTo:r,resolve:{event:function(){return e}}}).result.then(function(e){},function(){console.log("Modal dismissed at: "+new Date)})}}]).controller("EventController",["$scope","$uibModalInstance","event",function(e,t,r){e.history=r,e.cancel=function(){t.close("")}}])}(angular,jQuery),function(e,t){t.module("elthelas").factory("divineProvider",["$q","$http",function(e,t){var r={};return r.getDivines=function(){var r=e.defer();return t.get("/json/divines.json").then(function(e){r.resolve(e)},function(e){r.reject()}),r.promise},r}])}(jQuery,angular),function(e,t){t.module("elthelas").factory("godProvider",["$q","$http",function(e,t){var r={};return r.getGods=function(){var r=e.defer();return t.get("/json/gods.json").then(function(e){r.resolve(e)},function(e){r.reject()}),r.promise},r}])}(jQuery,angular),function(e,t){t.module("elthelas").factory("organizationProvider",["$q","$http",function(e,t){var r={};return r.getOrganizations=function(){var r=e.defer();return t.get("/json/organizations.json").then(function(e){r.resolve(e)},function(e){r.reject()}),r.promise},r}])}(jQuery,angular),function(e,t){t.module("elthelas").factory("raceProvider",["$q","$http",function(e,t){var r={};return r.getRaces=function(){var r=e.defer();return t.get("/json/races.json").then(function(e){r.resolve(e)},function(e){r.reject()}),r.promise},r}])}(jQuery,angular),function(e){var t={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,r,o,a,l,n="",i="",s="",c=0;do{t=e.charCodeAt(c++),r=e.charCodeAt(c++),i=e.charCodeAt(c++),o=t>>2,a=(3&t)<<4|r>>4,l=(15&r)<<2|i>>6,s=63&i,isNaN(r)?l=s=64:isNaN(i)&&(s=64),n=n+this.keyStr.charAt(o)+this.keyStr.charAt(a)+this.keyStr.charAt(l)+this.keyStr.charAt(s),t=r=i="",o=a=l=s=""}while(c<e.length);return n},decode:function(e){var t,r,o,a,l,n="",i="",s="",c=0;/[^A-Za-z0-9\+\/\=]/g.exec(e)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{o=this.keyStr.indexOf(e.charAt(c++)),a=this.keyStr.indexOf(e.charAt(c++)),l=this.keyStr.indexOf(e.charAt(c++)),s=this.keyStr.indexOf(e.charAt(c++)),t=o<<2|a>>4,r=(15&a)<<4|l>>2,i=(3&l)<<6|s,n+=String.fromCharCode(t),64!==l&&(n+=String.fromCharCode(r)),64!==s&&(n+=String.fromCharCode(i)),t=r=i="",o=a=l=s=""}while(c<e.length);return n}};angular.module("elthelas").factory("AuthenticationProvider",["$http","$cookies","$rootScope","$timeout",function(e,r,o,a){function l(t,r,o){return e({method:"POST",url:"app_dev.php/login_check",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")},data:{_username:t,_password:r}}).then(function(e){o(e)})}function n(t,r,o,a,l,n){if(r!==o)return!1;e({method:"POST",url:"app_dev.php/register/",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"fos_user_registration_form[email]="+encodeURIComponent(a)+"&fos_user_registration_form[username]="+encodeURIComponent(t)+"&fos_user_registration_form[plainPassword][first]="+encodeURIComponent(r)+"&fos_user_registration_form[plainPassword][second]="+encodeURIComponent(o)+"&fos_user_registration_form[_token]="+encodeURIComponent(l)}).then(function(e){n(e)})}function i(a,l,n){var i=t.encode(a+":"+l);o.globals={currentUser:{username:a,password:l}},e.defaults.headers.common.Authorization="Basic "+i;var s=new Date;s.setDate(s.getDate()+7),n&&r.putObject("globals",o.globals,{expires:s})}function s(){o.globals={},r.remove("globals"),e.defaults.headers.common.Authorization="Basic"}var c={};return c.Login=l,c.SetCredentials=i,c.ClearCredentials=s,c.Register=n,c.LoadFromCookies=function(){o.globals=r.get("globals")},c}])}(angular),function(e,t){t.module("elthelas").factory("SpellProvider",["$q","$http",function(e,t){var r={};return r.getSpells=function(){var r=e.defer();return t.get("/json/spells.json").then(function(e){r.resolve(e)},function(e){r.reject()}),r.promise},r}])}(jQuery,angular),function(e,t){t.module("elthelas").factory("HistoryProvider",["$q","$http",function(e,t){var r={};return r.getHistory=function(){var r=e.defer();return t.get("/json/history.json").then(function(e){r.resolve(e)},function(e){r.reject()}),r.promise},r}])}(jQuery,angular);